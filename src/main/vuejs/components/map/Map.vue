<template>          
    <div id="mapContainer" style="width:100%; height:420px"></div>
</template>
        
<script>
    import echarts from 'echarts'
    require('./china')  //引入china.js地图文件
    import resize from '@/components/charts/mixins/resize'
    import Util from '@/utils/'
    export default {
        name: 'Map',
        props:['resources'],
        mixins: [resize],
        data () {
          return {  
              chart:null,
          }
        },
        methods: {
            
            
          drawChinaMap() {
           
            const that = this;
            var data = this.resources
            // var data = [
            //     { name: "上海", value: 29780},
            //      { name: "广州", value: 15769},
            //      { name: "北京", value: 20259},
            // ];

            var geoCoordMap = {
                "110000":[116.3809433,39.9236145],
                "120000":[117.2034988,39.13111877],
                "130000":[114.4897766,38.04512787],
                "130100":[114.4897766,38.04512787],
                "130200":[118.2017288,39.62533951],
                "130300":[119.5982971,39.92430878],
                "130400":[114.4729538,36.60151672],
                "130500":[114.4950867,37.06558991],
                "130600":[115.5001831,38.85707092],
                "130700":[114.8787766,40.81744003],
                "130800":[117.9223404,40.96760178],
                "130900":[116.8607712,38.30884171],
                "131000":[116.6898575,39.51511002],
                "131100":[115.7081909,37.72782135],
                "140000":[112.5693512,37.87111282],
                "140100":[112.5693512,37.87111282],
                "140200":[113.2963333,40.0971489],
                "140300":[113.5742569,37.86065674],
                "140400":[113.1055679,36.18191147],
                "140500":[112.84272,35.50651169],
                "140600":[112.4232712,39.31313324],
                "140700":[112.7453613,37.67613983],
                "140800":[110.9911499,35.01391602],
                "140900":[112.7315521,38.39920807],
                "141000":[111.5141678,36.08282471],
                "141100":[111.1348114,37.512043],
                "150000":[111.6632996,40.82094193],
                "150100":[111.6632996,40.82094193],
                "150200":[109.8517075,40.6664238],
                "150300":[106.8148727,39.67420197],
                "150400":[118.9498215,42.26798248],
                "150500":[122.2603302,43.61156082],
                "150600":[109.7808671,39.60844559],
                "150700":[119.7305603,49.21152878],
                "150800":[107.3945694,40.76234055],
                "150900":[113.0985184,41.03116608],
                "152200":[122.0381598,46.08207144],
                "152500":[116.0477155,43.9331762],
                "152900":[105.7289837,38.8515317],
                "210000":[123.4116821,41.7966156],
                "210100":[123.4116821,41.7966156],
                "210200":[121.6008377,38.91780472],
                "210300":[122.9843826,41.11525726],
                "210400":[123.9295578,41.84786606],
                "210500":[123.7645035,41.28758621],
                "210600":[124.3814621,40.13518143],
                "210700":[121.1333695,41.11112595],
                "210800":[122.2241516,40.66835022],
                "210900":[121.6488037,42.00795364],
                "211000":[123.1617432,41.26513672],
                "211100":[122.0476303,41.18847656],
                "211200":[123.844429,42.29558182],
                "211300":[120.4514694,41.57785797],
                "211400":[120.8474808,40.75334168],
                "220000":[125.3154297,43.89256287],
                "220100":[125.3154297,43.89256287],
                "220200":[126.5668182,43.88667679],
                "220300":[124.377449,43.16560745],
                "220400":[125.1372833,42.90859222],
                "220500":[125.9231262,41.7232933],
                "220600":[126.421608,41.93033218],
                "220700":[124.82204,45.172604],
                "220800":[122.8395767,45.61641693],
                "222400":[129.5091262,42.89120266],
                "230000":[126.6433411,45.74149323],
                "230100":[126.6433411,45.74149323],
                "230200":[123.9592667,47.34136963],
                "230300":[130.9477539,45.2970047],
                "230400":[130.2761993,47.33728409],
                "230500":[131.1521607,46.6376915],
                "230600":[125.0248566,46.59545136],
                "230700":[128.9043121,47.72364426],
                "230800":[130.36232,46.81366348],
                "230900":[130.8753967,45.80927277],
                "231000":[129.5984955,44.58392334],
                "231100":[127.4869385,50.24448776],
                "231200":[126.98349,46.63701248],
                "232700":[124.5921351,51.9239847],
                "310000":[121.4692688,31.23817635],
                "320000":[118.7727814,32.04761505],
                "320100":[118.7727814,32.04761505],
                "320200":[120.2991333,31.57723045],
                "320300":[117.1856079,34.26752853],
                "320400":[119.9502869,31.78393364],
                "320500":[120.6187286,31.31645203],
                "320600":[120.8555679,32.01506805],
                "320700":[119.1668015,34.60517883],
                "320800":[119.14111,33.502789],
                "320900":[120.1351776,33.38982773],
                "321000":[119.4368362,32.39188767],
                "321100":[119.4442978,32.20589829],
                "321200":[119.91124,32.495872],
                "321300":[118.29706,33.958302],
                "330000":[120.1592484,30.26599503],
                "330100":[120.1592484,30.26599503],
                "330200":[121.5412827,29.87066841],
                "330300":[120.6502914,28.01647568],
                "330400":[120.7536316,30.77111435],
                "330500":[120.0971298,30.86603928],
                "330600":[120.5739288,30.01093102],
                "330700":[119.6522064,29.11081696],
                "330800":[118.8691788,28.9584446],
                "330900":[122.1016083,30.02004242],
                "331000":[121.4205629,28.6561185],
                "331082":[121.1184464,28.84889221],
                "331100":[119.9165573,28.44883728],
                "340000":[117.2757034,31.86325455],
                "340100":[117.2757034,31.86325455],
                "340200":[118.3598328,31.33449554],
                "340300":[117.3613815,32.93924332],
                "340400":[117.0207291,32.6166954],
                "340500":[118.4807129,31.72492409],
                "340600":[116.7874985,33.9704895],
                "340700":[117.813179,30.92524719],
                "340800":[117.0344315,30.51264572],
                "341000":[118.3090668,29.72084427],
                "341100":[118.3011627,32.31653214],
                "341200":[115.8097305,32.90220642],
                "341300":[116.9701538,33.6401329],
                "341500":[116.4927902,31.75352287],
                "341600":[115.7709,33.879292],
                "341700":[117.4773331,30.65686607],
                "341800":[118.7586551,30.94078918],
                "350000":[119.2978134,26.07859039],
                "350100":[119.2978134,26.07859039],
                "350200":[118.0875168,24.45743561],
                "350300":[119.0103226,25.43813705],
                "350400":[117.6012268,26.22301292],
                "350500":[118.5896378,24.91591835],
                "350600":[117.6530914,24.51816368],
                "350700":[118.1691208,26.64484215],
                "350800":[117.0303879,25.10970306],
                "350900":[119.5183182,26.6664772],
                "360000":[115.8999176,28.67599106],
                "360100":[115.8999176,28.67599106],
                "360200":[117.1179428,29.19516754],
                "360300":[113.841423,27.63298988],
                "360400":[115.984581,29.72321129],
                "360500":[114.9293823,27.80654717],
                "360600":[117.0302811,28.2455864],
                "360700":[114.9336777,25.85288239],
                "360800":[114.9704285,27.1062088],
                "360900":[114.3746109,27.79557419],
                "361000":[116.3010483,27.93483162],
                "361100":[117.9634018,28.45326614],
                "370000":[117.0056,36.6670723],
                "370100":[117.0056,36.6670723],
                "370200":[120.3581696,36.13386154],
                "370300":[118.0560532,36.7935791],
                "370400":[117.556282,34.87264633],
                "370500":[118.4959564,37.46191406],
                "370600":[121.3799362,37.53561401],
                "370700":[119.1068497,36.7040863],
                "370800":[116.576561,35.40924072],
                "370900":[117.1241074,36.1871109],
                "371000":[122.1116867,37.50076294],
                "371100":[119.4515533,35.42756271],
                "371200":[117.66173,36.205116],
                "371300":[118.3379593,35.06945038],
                "371400":[116.2878723,37.45369339],
                "371500":[115.9884262,36.44943237],
                "371600":[118.0217667,37.36781311],
                "371700":[115.4457626,35.24853897],
                "410000":[113.6500473,34.7570343],
                "410100":[113.6500473,34.7570343],
                "410200":[114.3461685,34.7851944],
                "410300":[112.4247971,34.66804123],
                "410400":[113.3001938,33.74362946],
                "410500":[114.3500519,36.09685135],
                "410600":[114.1546707,35.94008255],
                "410700":[113.8685532,35.30746841],
                "410800":[113.2217865,35.24735642],
                "410900":[115.0149536,35.70189667],
                "411000":[113.8215866,34.02685928],
                "411100":[114.0410919,33.57250977],
                "411200":[111.1952591,34.78076935],
                "411300":[112.5375137,32.99901962],
                "411400":[115.6471863,34.44358444],
                "411500":[114.0677185,32.13063049],
                "411600":[114.6372528,33.62804031],
                "411700":[114.0356903,32.97904205],
                "419001":[112.6027201,35.06706997],
                "420000":[114.2919388,30.56751442],
                "420100":[114.2919388,30.56751442],
                "420200":[115.0749893,30.21379852],
                "420300":[110.7827988,32.65213013],
                "420500":[111.2852707,30.70395279],
                "420600":[112.1411133,32.04539871],
                "420700":[114.8811874,30.40276718],
                "420800":[112.2002106,31.03021622],
                "420900":[113.9113312,30.92845535],
                "421000":[112.2477875,30.31733513],
                "421100":[114.8649292,30.44901848],
                "421200":[114.2687378,29.89432716],
                "421300":[113.36982,31.715105],
                "422800":[109.4881804,30.27218711],
                "429004":[113.4545113,30.36252891],
                "429005":[112.8993007,30.40148025],
                "429006":[113.1661477,30.66340805],
                "429021":[110.6759643,31.74451435],
                "430000":[112.9812698,28.20082474],
                "430100":[112.9812698,28.20082474],
                "430200":[113.1520615,27.85422325],
                "430300":[112.9150238,27.87335014],
                "430400":[112.5993576,26.90055466],
                "430500":[111.4773789,27.25023651],
                "430600":[113.0980682,29.37461853],
                "430700":[111.6876297,29.03820992],
                "430800":[110.4814835,29.13187981],
                "430900":[112.3340683,28.60197067],
                "431000":[113.0286484,25.80229187],
                "431100":[111.6121979,26.2112999],
                "431200":[109.9542313,27.54740715],
                "431300":[111.9938965,27.74133492],
                "433100":[109.7389287,28.31173554],
                "440000":[113.2614288,23.11891174],
                "440100":[113.2614288,23.11891174],
                "440200":[113.6053925,24.80877686],
                "440300":[114.110672,22.55639648],
                "440400":[113.5682602,22.27258873],
                "440500":[116.6837997,23.36269188],
                "440600":[113.1145172,23.03487778],
                "440700":[113.0847473,22.59119034],
                "440800":[110.3992233,21.19499779],
                "440900":[110.8888474,21.67071724],
                "441200":[112.4514084,23.05788231],
                "441300":[114.3924027,23.08795738],
                "441400":[116.1079407,24.31450081],
                "441500":[115.3640137,22.77868652],
                "441600":[114.6938171,23.73484039],
                "441700":[111.9578934,21.84523392],
                "441800":[113.0212631,23.71959686],
                "441900":[113.7487717,23.0485363],
                "442000":[113.3714523,22.52685356],
                "445100":[116.63666,23.667706],
                "445200":[116.34977,23.542976],
                "445300":[112.03999,22.933193],
                "450000":[108.3117676,22.80654335],
                "450100":[108.3117676,22.80654335],
                "450200":[109.4028091,24.31040573],
                "450300":[110.2866821,25.28188324],
                "450400":[111.3059464,23.48661995],
                "450500":[109.1191711,21.47979736],
                "450600":[108.35658,21.768936],
                "450700":[108.6147003,21.94986916],
                "450800":[109.60844,23.099092],
                "450900":[110.1414719,22.63189697],
                "451000":[106.6121063,23.90158272],
                "451100":[111.53455,24.417259],
                "451200":[108.0516281,24.69689179],
                "451300":[109.23294,23.73144],
                "451400":[107.35506,22.420197],
                "460000":[110.3465118,20.03179359],
                "460100":[110.3465118,20.03179359],
                "460200":[109.5078201,18.23404312],
                "460300":[112.33356,16.83272],
                "460400":[109.5806849,19.52092966],
                "469001":[109.5169672,18.77516377],
                "469002":[110.4746526,19.25839642],
                "469005":[110.797742,19.54330274],
                "469006":[110.3897474,18.79532292],
                "469007":[108.6536594,19.09613826],
                "469021":[110.3590789,19.68133946],
                "469022":[110.1034735,19.35182579],
                "469023":[110.0048522,19.73847934],
                "469024":[109.690764,19.91242821],
                "469025":[109.4516753,19.22543478],
                "469026":[109.0555816,19.29827945],
                "469027":[109.1736131,18.7498679],
                "469028":[110.0371871,18.50595483],
                "469029":[109.7025825,18.63904542],
                "469030":[109.8382244,19.03322394],
                "500000":[106.5103378,29.55817604],
                "510000":[104.0817566,30.66105652],
                "510100":[104.0817566,30.66105652],
                "510300":[104.7763519,29.36772156],
                "510400":[101.6984177,26.55479813],
                "510500":[105.4378433,28.88199425],
                "510600":[104.3915482,31.13044548],
                "510700":[104.7485504,31.45634842],
                "510800":[105.8317032,32.44396973],
                "510900":[105.5697098,30.50339317],
                "511000":[105.0534363,29.57756805],
                "511100":[103.7514038,29.56822395],
                "511300":[106.0816269,30.79582214],
                "511400":[103.83146,30.050497],
                "511500":[104.6168671,28.77025604],
                "511600":[106.63175,30.474428],
                "511700":[107.5003433,31.22469711],
                "511800":[102.9826965,29.98229408],
                "511900":[106.75476,31.849014],
                "512000":[104.65019,30.122671],
                "513200":[102.2247375,31.89937935],
                "513300":[101.962514,30.04930605],
                "513400":[102.2674383,27.88162244],
                "520000":[106.7113724,26.57687378],
                "520100":[106.7113724,26.57687378],
                "520200":[104.8732529,26.5767746],
                "520300":[106.9293976,27.69538689],
                "520400":[105.9260712,26.24425888],
                "520500":[105.2824173,27.3062954],
                "520600":[109.1926804,27.72216606],
                "522300":[104.9043531,25.08987278],
                "522600":[107.9841392,26.5836279],
                "522700":[107.5222592,26.25427309],
                "530000":[102.704567,25.04384422],
                "530100":[102.704567,25.04384422],
                "530300":[103.7947006,25.49616623],
                "530400":[102.5332336,24.35497284],
                "530500":[99.16872406,25.11680222],
                "530600":[103.7149277,27.34227943],
                "530700":[100.2342529,26.87666512],
                "530800":[100.9752121,22.79548073],
                "530900":[100.0878067,23.8799305],
                "532300":[101.5276607,25.04494301],
                "532500":[103.3755878,23.36421652],
                "532600":[104.2150486,23.39868766],
                "532800":[100.7973892,22.0074942],
                "532900":[100.2676255,25.60646837],
                "533100":[98.58484387,24.4323115],
                "533300":[98.85671501,25.81753271],
                "533400":[99.70302652,27.81906659],
                "540000":[91.11445308,29.64411352],
                "540100":[91.11445308,29.64411352],
                "540200":[88.88110958,29.26701395],
                "540300":[97.17220509,31.14069782],
                "540400":[94.36153102,29.64893975],
                "540500":[91.77308713,29.23701982],
                "540600":[92.0513207,31.47611103],
                "542500":[81.14540521,30.40052298],
                "610000":[108.949028,34.26168442],
                "610100":[108.949028,34.26168442],
                "610200":[109.0572815,35.07545853],
                "610300":[107.1383591,34.38228607],
                "610400":[108.7101288,34.33721542],
                "610500":[109.5008392,34.50152588],
                "610600":[109.471283,36.59387207],
                "610700":[107.0343933,33.07814789],
                "610800":[109.7574463,38.29727554],
                "610900":[109.0257874,32.68986511],
                "611000":[109.9403909,33.87035105],
                "620000":[103.7500534,36.06803894],
                "620100":[103.7500534,36.06803894],
                "620200":[98.27471161,39.80265427],
                "620300":[102.1657486,38.49519348],
                "620400":[104.1837769,36.53941727],
                "620500":[105.7152405,34.58426666],
                "620600":[102.633461,37.9269104],
                "620700":[100.4502869,38.93505859],
                "620800":[106.6830673,35.53551865],
                "620900":[98.51111603,39.74496841],
                "621000":[107.6362305,35.73855972],
                "621100":[104.6185684,35.57523727],
                "621200":[104.92928,33.39484],
                "622900":[103.2108906,35.60121067],
                "623000":[102.9109863,34.98324974],
                "630000":[101.7778162,36.61728828],
                "630100":[101.7778162,36.61728828],
                "630200":[102.4017109,36.48207227],
                "632200":[100.9009262,36.95451784],
                "632300":[102.0150337,35.51988388],
                "632500":[109.854136,19.27825],
                "632600":[100.2447092,34.47138225],
                "632700":[97.00645511,33.00525219],
                "632800":[97.37119774,37.37707972],
                "640000":[106.2719421,38.46800995],
                "640100":[106.2719421,38.46800995],
                "640200":[106.3820572,39.02428055],
                "640300":[106.1991119,37.98549652],
                "640400":[106.2785873,36.01325989],
                "640500":[105.18661,37.513252],
                "650000":[89.1895474,42.95130195],
                "650100":[87.60611725,43.79093933],
                "650200":[84.86360931,45.59651184],
                "650400":[89.1895474,42.95130195],
                "650500":[93.51536928,42.81854115],
                "652300":[87.30817902,44.01114114],
                "652700":[82.06674632,44.90603596],
                "652800":[86.14517515,41.76404026],
                "652900":[80.2600596,41.1684029],
                "653000":[76.16660835,39.71529724],
                "653100":[75.98973068,39.47039628],
                "653200":[79.92243983,37.11429217],
                "654000":[81.32412996,43.91686827],
                "654200":[82.98043953,46.74531234],
                "654300":[88.14031038,47.8456187],
                "659001":[86.078911,44.30652036],
                "659002":[81.28064163,40.54795812],
                "659003":[79.06901071,39.8649427],
                "659004":[87.54014426,44.16797119],
                "659005":[87.80014797,47.36328619],
                "659006":[85.67585289,41.86869689],
                "659007":[82.35500262,44.84417562],
                "659008":[81.04474154,43.94797595],
                "659009":[79.29125037,37.20942446],
                "710000":[120.960515,23.69781],
                "810000":[114.109497,22.396428],
                "820000":[113.5440083,22.20167546],
                };

            var convertData = function(data) {
                //console.log(that.resources,'aaaa')
                //const data = that.resources
                var res = [];
                for (var i = 0; i < data.length; i++) {
                    var geoCoord = geoCoordMap[data[i].code];
                    if (geoCoord) {
                        res.push({
                            name: data[i].orgName,
                            value: geoCoord.concat(data[i].value),
                            other: data[i]
                        });
                    }
                }
                return res;
            };

            var convertedData = [
                convertData(data),
                convertData(data.sort(function(a, b) {
                    return b.value - a.value;
                }).slice(0, 6))
            ];
            data.sort(function(a, b) {
                return a.value - b.value;
            })
            console.log(convertedData[0],'mapData')
        
            let option = {
                backgroundColor: "transparent",
                tooltip: {
                    padding: 0,
                    enterable: true,
                    transitionDuration: 1,
                    //formatter: '{b0}: {c0}',
                    formatter:function(params){
                        console.log(params,'fffff')
                        const  totalInCome =params.data.other.totalIncome
                         const  totalExpenditure =params.data.other.totalExpenditure
                          const  totalGrossProfit =params.data.other.totalGrossProfit
                       return '<div style="padding:10px;"><strong>'+params.data.name+'：</strong>'+
                       '<br/>总收入：'+Util.numberFormat(totalInCome)+'元'+
                       '<br/>总支出：'+Util.numberFormat(totalExpenditure)+'元'+
                       '<br/>毛利润：'+Util.numberFormat(totalGrossProfit)+'元</div>'
                    },
                },
                geo: {
                    map: 'china',
                    zoom: 1,
                    scaleLimit:{
                        min:0.8,
                        max:1.5,
                    },
                    label: {
                        emphasis: {
                            show: false
                        }
                    },
                    roam: true,
                    itemStyle:{
                        areaColor: 'transparent',
                        borderColor:'#005AA2',
                        emphasis:{label:{show:true}}
                    },
                },
        
                series : [
                    {
                    
                    type: 'scatter',
                    coordinateSystem: 'geo',
                    data: convertedData[0],
                    symbolSize:12,
                    itemStyle: {
                        normal: {
                            color: '#FBB03B',
                            position: 'right',
                            show: true
                        }
                    }
                }, 
                {
                   
                    type: 'effectScatter',
                    coordinateSystem: 'geo',
                    data: convertedData[0],
                    // symbolSize: function(val) {
                    //     return Math.max(val[2] / 2000, 8);
                    // },
                    showEffectOn: 'render',
                    rippleEffect: {
                        brushType: 'stroke'
                    },
                    hoverAnimation: true,
                    // label: {
                    //     normal: {
                    //         formatter: '{b}',
                    //         position: 'right',
                    //         show: true
                    //     }
                    // },
                    itemStyle: {
                        normal: {
                            color: '#FBB03B',
                            position: 'right',
                            show: true
                        }
                    },
                    zlevel: 1
                }, 
                ]
            }
            this.chart.setOption(option);
            var count = 0;
            var timeTicket = null;
           
            timeTicket && clearInterval(timeTicket);
            timeTicket = setInterval(function() {}, 1000);
            this.chart.on('mouseover', function(params) {
                console.log(params)
                clearInterval(timeTicket);
                that.chart.dispatchAction({
                    type: 'downplay',
                    seriesIndex: 0
                });
                // that.chart.dispatchAction({
                //     type: 'highlight',
                //     seriesIndex: 0,
                //     dataIndex: params.dataIndex
                // });
                // that.chart.dispatchAction({
                //     type: 'showTip',
                //     seriesIndex: 0,
                //     dataIndex: params.dataIndex,
                // });
            });
            this.chart.on('mouseout', function(params) {});
          }
        },
        mounted() {
          this.chart = echarts.init(document.getElementById('mapContainer'));
          this.drawChinaMap();
        
        },
        beforeDestroy() {
            if (!this.chart) {
            return
            }
            this.chart.dispose()
            this.chart = null
        },
    }
</script>

